---
title: 从零搭建博客 (Ongoing)
abbrlink: 41986
date: 2020-07-30 17:36:35
---

技术栈：

> React (前端框架)
>
> Python (后端API)
>
> Nginx (WEB服务器，链接前端与WSGI服务器)
>
> uWSGI (网关，链接服务器与后端)
>
> Docker (容器化)
>
> Google Cloud Platform (云端服务器)
>
> Kubernetes (管理容器化的app，负载，和服务；自动化部署容器)
>
> Google Domains (购买域名)

<br>

----

<br>

### 前言

在把这个网站真正搭起来之前，其实我也有过专门写博客的网站。但是构建的过程几乎没有涉及到任何开发方面的知识，源代码用的是hexo框架，服务器用的是github为每个账号都提供的github.io。在godaddy上买了个域名，看着别人写的教程照猫画虎就搭起来了。用起来没有什么问题，自己调整了一些配置之后也比较满意。但是毕竟不能算自己写的网站，也无法知道开发过程中的各种细节和原理，于是借着这次实习的空隙，花了几周时间认真研究了一下，重写了所有代码和服务，总算是真正有了自己的网站。写这篇文章也是想根据折腾的过程，来总结和简化一下开发的过程。如果有想做类似事情的同学看到这篇文章，也能少走一些弯路。虽然涉及了不少技术，但是我也只是略微学懂了一些表面上的东西，想必过程还有很多可以优化的地方，感谢各位提出意见。

### 一：结构

在写细节之前，我们有必要对整个网站的结构做一下描述。

任何网站都分为前端和后端，前端决定了用户看到的界面是什么样子的，后端则是为前端提供需要渲染出来的信息。拿kefan.me举例，网站打开之后，前端需要知道我写了哪些文章，于是向后端发送一个请求。后端接到这个请求之后开始处理，然后再把博客的列表返回前端，这时候前端知道了这些信息，于是把他们渲染到特定的位置。这也是典型的前后端分离的逻辑，个人来说也是比较符合直觉的一种设计。前端只负责网站看起来是怎么样的，后端提供的也只有一个api的借口，作为处理请求和数据的工具人。当然，在具体操作的时候，在前后端中间还要添加两个中间层，一个是nginx，一个是uWSGI。后者把api运行在一个端口上，而前者则监听来自前端的请求，如果有朝后端发射的请求，则把请求的内容发送到后端的端口上。目前这两个过程听起来还很抽象，等实际进行到那一步的时候我们会发现这些操作都是很直观的。

在这些步骤都完成之后，这个网站已经可以在本地（localhost）运行起来了，下一步就是把它部署到一个服务器上。这里我选择的是Google Cloud Platform (GCP)，服务器的选择并没有太大的区别，目前主流的几家平台（Azure, AWS, GCP）都可以提供足够的服务（毕竟这个博客也没有多大的流量），选择谷歌只是因为价格比较便宜，交互的界面看着也比较顺眼。当进行到这一步的时候，在任何设备的浏览器上输入谷歌提供的ip就可以看到网站了（格式大概为 http://xx.xx.xxx.xxx ）。最后一步要做的就是把这个ip地址和购买的域名连接起来。对于我来说前端和后端写起来都比较轻松，虽然代码数量比较多，但是起码知道怎么写，而且任何问题都可以在网上搜到解决的办法；真正难到痛苦的是后面的几个步骤，因为根本没有找到一个足够详细的教程来解决我的问题，遇到不懂的只能根据log里面的错误信息去官方的文档里找，来回反复改了几十次，总算才把问题都解决了。希望这篇文章可以把整个过程讲清楚。

### 一：准备工作

整个网站的开发是在MacOS上进行的，所以用linux的同学估计不用有太多担心。用Windows的话建议装一下WSL2，这样就可以避免很多兼容性的问题。毕竟微软的开发环境实在是比较一言难尽。

一些需要提前安装的东西：

```
prerequisite
  |_nodejs
    |_npm
    |_npx
    |_create-react-app
  |_python37
    |_pip
    |_virtualenv
  |_docker
    |_docker desktop
  |_nginx
  |_k8s stuff
    |_google account
    |_gcloud cli tool
    |_kubectl
```

这些东西也不必提前装好，写在这里只是为了看的时候清楚一点。

另外域名也是一个需要考虑的部分，每个网址的价格都不一样，比如 ke.fan 这个短小酷炫的域名一年的租金就要600+CAD，实在是买不起。而目前使用的 kefan.me 每年的租金也只有30刀不到。关于购买域名的网站我比较推荐 Google Domain 和 GoDaddy。都是大网站，客服也比较到位。

另外值得一提的是如果要注册国内的域名的话需要去指定的管理局备案，这个过程大概要花费几周，但是具体细节就不清楚了。

Now let’s get started.

### 二：前端（React）

首先我们用react官方提供的脚手架创建一个项目，名字就叫做mywebsite（这个过程可能会需要几分钟）

```
$ mkdir mywebsite
$ cd mywebsite
$ npx create-react-app
```

完成之后一个粗糙的项目结构就出来了，输入

```
$ npm install
$ npm start
```

就可以在本地的 localhost:3000 上看到初始的网站了。

待更新

### 三：后端（Flask + uWSGI)

待更新

### 四：容器化（Docker + Nginx）

待更新

### 五：把容器化的网站部署到GCP（k8s）

待更新

### 六：把ip地址绑定到域名

待更新

### 七：ToDo

- 为网站注册ssl证书（这样网址前缀就从http变成了更为安全的https）
- 在每篇博客下面开放评论区
- 服务端渲染（SSR）
- 优化Docker镜像的体积
- 翻页功能

### 后记

待更新